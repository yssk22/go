# See the guide: https://circleci.com/docs/language-go/
# but $HOME/.go_project is not included in $GOPATH actually
machine:
  environment:
    GOPATH: "${HOME}/.go_workspace:/usr/local/go_workspace:${HOME}/.go_project"

dependencies:
  override:
    - mkdir -p "${HOME}/.go_project/src/github.com/${CIRCLE_PROJECT_USERNAME}"
    - ln -sf "${HOME}/${CIRCLE_PROJECT_REPONAME}/" "${HOME}/.go_project/src/github.com/${CIRCLE_PROJECT_USERNAME}/${CIRCLE_PROJECT_REPONAME}"
test:
  override:
    - go test -race ./...

deployment:
  develop:
    branch: develop
    commands:
      - git config --global user.name "yssk22"
      - git config --global user.email "yssk22@gmail.com"
      - git fetch origin master
      - git checkout master
      - git merge develop --no-ff -m "Merge 'develop' (CI auto merge)"
      - git push origin master